# Logloom 实现指导文档

---

## 1. 文档目的（Purpose）

以已完成的 01\~06 号设计文档为基础，明确每个模块的依赖关系、构建顺序、接口约束与测试要求，
确保能够可靠、高效、符合规范地分阶段完成程序实现。

---

## 2. 全局视角与分层理解路径（Hierarchical Understanding）

实现前，应先建立完整的全局理解结构：

1. **第一阶段：总体蓝图理解**

   * 阅读 01\_HighLevelDesign.md §1\~§4：理解模块边界、构建限制、关键流程与系统目标
   * 关注图 2 和表 1，明确模块名称与职责

2. **第二阶段：模块设计细化**

   * 根据系统分工顺序阅读 02\~06 文档，对每个子系统的接口、格式、依赖进行掌握
   * 对每份文档中的“模块接口”、“配置策略”、“失败回退”等部分做标记

3. **第三阶段：设计→实现里程碑映射**（见下节）

---

## 3. 实现里程碑规划（Milestone Planning）

建议将项目划分为如下里程碑阶段，每一阶段均可独立验证并具备可运行子集。

| 里程碑编号 | 名称             | 完成标志                             | 涉及设计文档        |
| ----- | -------------- | -------------------------------- | ------------- |
| M0    | 初始化项目结构        | 完成 Makefile / 源码目录 / YAML 输入结构   | 01 §2.1\~§2.2 |
| M1    | 多语言支持构建与核心     | 能够加载 YAML 并通过 `lang_get()` 取出字符串 | 02 §2\~§4     |
| M2    | 日志系统初步         | 输出结构化日志到控制台 / 文件，支持多等级           | 03 §2\~§4.1   |
| M3    | 配置加载与默认合并      | 正确加载配置 YAML 并生成头文件 / 结构体         | 04 §2\~§5     |
| M4    | 日志文件轮转功能       | 日志达到最大容量后成功生成新文件                 | 03 §4.2\~§4.3 |
| M5    | 插件注册与运行框架      | 成功加载 `.so` 插件并执行其 process()      | 05 §3\~§5     |
| M6    | 测试集成           | 所有模块能通过至少 3 条测试用例验证              | 06 全文         |
| M7    | 最小可运行版本（MVP）发布 | 执行演示程序，加载语言+配置，写入日志              | 01 §4 + 全体系   |

---

## 4. 子模块 → 文档参考表（Implementation Reference Mapping）

| 子模块       | 目标文件/目录                          | 参考文档章节          |
| --------- | -------------------------------- | --------------- |
| 语言构建脚本    | `tools/generate_lang_headers.py` | 02 §3.3、§4.1    |
| 语言系统核心    | `src/lang/lang.h/.c`             | 02 §3.1、§3.2、§2 |
| 配置系统      | `src/config/config.h/.c`         | 04 §4、§5、§6     |
| 日志系统      | `src/log/log.h/.c`               | 03 §3、§4.1、§4.4 |
| 日志文件轮转    | `src/log/rotate.c`               | 03 §4.2、§4.3    |
| 插件加载与调用框架 | `src/plugin/loader.c`            | 05 §3.5、§4、§5   |
| 插件接口定义    | `include/plugin.h`               | 05 §3.1\~§3.4   |
| 测试系统      | `tests/` + `Makefile.test`       | 06 §2\~§4       |

---

## 5. 接口契约与命名规范（Interface Contracts）

* 函数命名：

  * 国际化接口见 02 文档 §3.2，如 `lang_getf()`
  * 日志接口见 03 文档 §3，如 `log_info()`、`log_error()`
  * 配置接口见 04 文档 §4.1，如 `config_load_from_file()`
  * 插件接口见 05 文档 §3.5/§3.6，如 `plugin_init()`、`plugin_process()`

* 宏与键命名：

  * 配置宏统一以 `LOGLOOM_` 为前缀（见 04 文档 §5）
  * 多语言 key 建议使用 `LOGLOOM_LANG_` 前缀（见 02 文档 §2.1）

---

## 6. 工程约束与实现策略（Engineering Constraints）

* 内核态模块不得依赖动态内存、第三方库，配置必须静态注入（参考 04 文档 §5）
* 日志模块需线程安全，文件写入应加锁（参考 03 文档 §4.4）
* 插件加载失败不得影响主程序运行，应实现降级策略（参考 05 文档 §5.3）

---

## 7. 测试与验证任务（Testing Checklist）

请在每个模块完成后执行以下检查项（参考 06 文档 §2\~§4）：

* ✅ 是否编写了对应的 YAML 输入与 golden 输出？
* ✅ 是否覆盖单元 + 集成用例？
* ✅ 是否触发错误场景并有容错机制？
* ✅ 是否通过 `make test` 脚本执行通过？
* ✅ 是否 CI 可执行（如输出 JUnit）？
